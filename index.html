<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calendario Mensual</title>
<style>
/* Paleta base (light) — tu paleta tal cual */
:root{
	--bg:#ffffff; --text:#111827; --muted:#374151; --muted-2:#6b7280;
	--card:#ffffff; --border:#e5e7eb; --shadow:0 2px 8px rgba(0,0,0,.06);
	--azul:#2563eb; --amarillo:#f59e0b; --verde:#10b981; --rojo:#ef4444;
	--gris:#f3f4f6; --btn:#f3f4f6; --btn-text:#111827;
	--badge-bg:#eef2ff; --badge-text:#1f2937; --kbd-bg:#111827; --kbd-text:#ffffff;
	color-scheme: light;

	--fg: var(--text);
	--accent: var(--azul);
	--accent-weak: var(--badge-bg);
	--hover: color-mix(in srgb, var(--btn) 85%, var(--accent) 15%);

	/* Tamaños fluidos */
	--fs: clamp(10px, 1.6vw, 14px);
	--fs-small: clamp(10px, 1.3vw, 12px);
	--pad: clamp(6px, 1.2vw, 10px);
	--gap: clamp(6px, 1.2vw, 8px);
	--round: clamp(8px, 1.6vw, 12px);
	--dot: clamp(22px, 5.5vw, 32px);

	/* Mini-controles (vista Fecha) */
	--mini-size: 24px;
	--mini-pad: 2px;
	--mini-gap: 4px;
}

/* Paleta base (dark) — tu paleta tal cual */
:root[data-theme="dark"]{
	--bg:#191919; --text:#e5e7eb; --muted:#c7cbd1; --muted-2:#9aa0a6;
	--card:#12161b; --border:#232a32; --shadow:0 2px 8px rgba(0,0,0,.35);
	--azul:#3b82f6; --amarillo:#f59e0b; --verde:#22c55e; --rojo:#f43f5e;
	--gris:#1a1f25; --btn:#1a1f25; --btn-text:#e5e7eb;
	--badge-bg:#1f2937; --badge-text:#e5e7eb; --kbd-bg:#0b0d10; --kbd-text:#ffffff;
	color-scheme: dark;

	--fg: var(--text);
	--accent: var(--azul);
	--accent-weak: var(--badge-bg);
	--hover: color-mix(in srgb, var(--btn) 85%, var(--accent) 15%);
	--fs: clamp(10px, 1.6vw, 14px);
	--fs-small: clamp(10px, 1.3vw, 12px);
	--pad: clamp(6px, 1.2vw, 10px);
	--gap: clamp(6px, 1.2vw, 8px);
	--round: clamp(8px, 1.6vw, 12px);
	--dot: clamp(22px, 5.5vw, 32px);
	--mini-size: 24px;
	--mini-pad: 2px;
	--mini-gap: 4px;
}

/* Base */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Inter, system-ui, Arial; background: var(--bg); color: var(--fg); }
.wrapper { max-width: 100%; margin: 0 auto; padding: var(--pad); font-size: var(--fs); }

/* Header */
.header {
	display: grid;
	grid-template-columns: 1fr auto auto; /* select | theme | toggle */
	gap: var(--gap);
	align-items: center;
	border: 1px solid var(--border);
	border-radius: calc(var(--round) - 2px);
	padding: var(--pad);
	background: transparent;
	min-width: 0;
}
@media (max-width: 420px) {
	.header { grid-template-columns: 1fr auto; grid-auto-rows: auto; }
	.view-toggle-header { grid-column: 1 / -1; justify-self: start; }
}

/* Controles generales */
.select { display: flex; gap: var(--gap); align-items: center; min-width: 0; }
select, button {
	background: var(--btn);
	color: var(--btn-text);
	border: 1px solid var(--border);
	border-radius: var(--round);
	padding: calc(var(--pad) - 2px) calc(var(--pad) + 2px);
	font-size: var(--fs);
	min-width: 0;
}
button { cursor: pointer; }
button:hover, select:hover { background: var(--hover); }

.theme-toggle {
	display: inline-flex; gap: calc(var(--gap) - 2px); align-items: center;
	border: 1px solid var(--border);
	padding: calc(var(--pad) - 3px) calc(var(--pad) + 1px);
	border-radius: 999px;
	background: var(--btn); color: var(--btn-text);
}

/* Toggle pequeño sin texto (iconos) en header */
.view-toggle-header {
	display: inline-flex; align-items: center; gap: 4px;
	border: 1px solid var(--border);
	background: var(--btn); color: var(--btn-text);
	border-radius: 999px; padding: 3px;
}
.view-toggle-header button {
	border: none; background: transparent; padding: 6px;
	border-radius: 999px; width: 28px; height: 28px;
	display: inline-flex; align-items: center; justify-content: center;
}
.view-toggle-header button[aria-pressed="true"] {
	background: var(--accent-weak); color: var(--fg); outline: 1px solid var(--border);
}

/* Calendario */
.calendar {
	margin-top: var(--gap);
	border: 1px solid var(--border);
	border-radius: calc(var(--round) + 0px);
	overflow: hidden; background: transparent;
}
.weekdays, .days { display: grid; grid-template-columns: repeat(7, 1fr); }
.weekdays div {
	text-align: center; font-weight: 600; font-size: var(--fs-small);
	color: var(--muted-2); background: var(--gris);
	padding: calc(var(--pad) - 2px) 0; border-bottom: 1px solid var(--border);
}
.day {
	position: relative; padding: clamp(8px, 1.6vw, 14px) 0; text-align: center;
	min-height: clamp(32px, 7vw, 44px);
	border-bottom: 1px solid var(--border); border-right: 1px solid var(--border);
}
.days .day:nth-child(7n) { border-right: none; }
.days .day:nth-last-child(-n+7) { border-bottom: none; }
.day .num {
	position: relative; z-index: 1; display: inline-flex; align-items: center; justify-content: center;
	width: var(--dot); height: var(--dot); border-radius: 50%; font-size: var(--fs);
}
.day.out { color: var(--muted-2); }
.day.today .num { background: var(--accent-weak); outline: 2px solid var(--accent); color: var(--fg); }

/* Vista "Fecha sola" */
.date-only {
	margin-top: var(--gap);
	border: 1px solid var(--border);
	border-radius: calc(var(--round) + 0px);
	background: transparent;
	padding: calc(var(--pad) + 2px);
	display: none;
	position: relative; /* para posicionar los mini-controles */
}
.date-only .line {
	display: flex; align-items: baseline; justify-content: center; gap: 10px; flex-wrap: wrap;
}
.date-only .day-badge {
	display: inline-flex; align-items: center; justify-content: center;
	width: calc(var(--dot) * 1.2); height: calc(var(--dot) * 1.2);
	border-radius: 50%; background: var(--accent-weak); outline: 2px solid var(--accent);
	color: var(--fg); font-size: calc(var(--fs) * 1.2); font-weight: 700;
}
.date-only .month-year {
	display: inline-flex; gap: 8px; align-items: baseline;
	padding: 6px 10px; border-radius: var(--round);
	background: var(--btn); color: var(--btn-text);
	border: 1px solid var(--border); font-weight: 600;
}
.date-only .weekday {
	font-size: var(--fs-small); color: var(--muted-2);
	text-transform: uppercase; letter-spacing: .04em;
}

/* Ocultar selectores, tema y toggle del header cuando data-view=date */
[data-view="date"] .header .select,
[data-view="date"] .header .theme-toggle,
[data-view="date"] .header .view-toggle-header { display: none !important; }

/* Forzar visibilidad correcta de contenedores por si el host inyecta estilos */
[data-view="date"] #calendarView { display: none !important; }
[data-view="date"] #dateOnlyView { display: block !important; }

/* Mini-controles en vista Fecha: abajo a la derecha, más pequeños */
.date-floating-controls {
	position: absolute; right: 8px; bottom: 8px;
	display: flex; gap: var(--mini-gap); align-items: center;
	opacity: 0; pointer-events: none; transform: translateY(4px);
	transition: opacity .18s ease, transform .18s ease;
}
.date-only:hover .date-floating-controls {
	opacity: 1; pointer-events: auto; transform: translateY(0);
}
.view-toggle-mini, .theme-toggle-mini {
	display: inline-flex; align-items: center;
	border: 1px solid var(--border);
	background: var(--btn); color: var(--btn-text);
	border-radius: 999px; padding: var(--mini-pad);
}
.view-toggle-mini button {
	border: none; background: transparent; padding: 4px;
	border-radius: 999px; width: var(--mini-size); height: var(--mini-size);
	display: inline-flex; align-items: center; justify-content: center;
}
.view-toggle-mini button[aria-pressed="true"] {
	background: var(--accent-weak); color: var(--fg); outline: 1px solid var(--border);
}
.theme-toggle-mini {
	padding: var(--mini-pad) calc(var(--mini-pad) + 2px);
	font-size: 11px; line-height: 1; border-radius: 999px;
}

/* Accesibilidad oculta */
.sr-only {
	position: absolute !important; height: 1px; width: 1px;
	overflow: hidden; clip: rect(1px, 1px, 1px, 1px);
	white-space: nowrap; border: 0; padding: 0; margin: -1px;
}
</style>
</head>
<body>
<div class="wrapper" id="app">
	<div class="header">
		<div class="select">
			<label class="sr-only" for="month">Mes</label>
			<select id="month" aria-label="Mes"></select>
			<label class="sr-only" for="year">Año</label>
			<select id="year" aria-label="Año"></select>
		</div>

		<!-- Botón de tema en header -->
		<button id="theme" class="theme-toggle" aria-label="Cambiar tema"><span id="themeLabel">Light</span></button>

		<!-- Toggle pequeño en header (iconos) -->
		<div class="view-toggle-header" role="group" aria-label="Cambiar vista">
			<button id="viewCalHeader" aria-pressed="true" aria-label="Vista calendario" title="Calendario">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v11a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
			</button>
			<button id="viewDateHeader" aria-pressed="false" aria-label="Vista fecha" title="Fecha">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm1 5h-2v6l5 3 1-1.732-4-2.268V7Z"/></svg>
			</button>
		</div>
	</div>

	<!-- Vista Calendario -->
	<div class="calendar" id="calendarView" role="grid" aria-labelledby="gridlabel">
		<div id="gridlabel" class="sr-only">Calendario mensual</div>
		<div class="weekdays" role="row">
			<div role="columnheader" aria-label="Lunes">L</div>
			<div role="columnheader" aria-label="Martes">M</div>
			<div role="columnheader" aria-label="Miércoles">X</div>
			<div role="columnheader" aria-label="Jueves">J</div>
			<div role="columnheader" aria-label="Viernes">V</div>
			<div role="columnheader" aria-label="Sábado">S</div>
			<div role="columnheader" aria-label="Domingo">D</div>
		</div>
		<div class="days" id="days"></div>
	</div>

	<!-- Vista Fecha sola con mini-controles abajo a la derecha -->
	<div class="date-only" id="dateOnlyView" aria-live="polite" aria-atomic="true">
		<div class="line">
			<span id="weekdayText" class="weekday">MARTES</span>
			<span id="dayBadge" class="day-badge">14</span>
			<span id="monthYear" class="month-year"><span id="monthText">OCTUBRE</span><span id="yearText">2025</span></span>
		</div>

		<div class="date-floating-controls">
			<!-- Toggle mini -->
			<div class="view-toggle-mini" role="group" aria-label="Cambiar vista">
				<button id="viewCalDate" aria-pressed="false" aria-label="Vista calendario" title="Calendario">
					<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v11a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
				</button>
				<button id="viewDateDate" aria-pressed="true" aria-label="Vista fecha" title="Fecha">
					<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm1 5h-2v6l5 3 1-1.732-4-2.268V7Z"/></svg>
				</button>
			</div>
			<!-- Tema mini -->
			<button id="themeFloating" class="theme-toggle-mini" aria-label="Cambiar tema" title="Tema">
				<span id="themeLabelFloating">Light</span>
			</button>
		</div>
	</div>
</div>

<script>
(function() {
	// Meses y días
	const monthNames = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
	const monthNamesUpper = monthNames.map(m => m.toUpperCase());
	const weekdayNamesUpper = ["LUNES","MARTES","MIÉRCOLES","JUEVES","VIERNES","SÁBADO","DOMINGO"];

	// Elementos
	const root = document.documentElement;
	const monthSel = document.getElementById('month');
	const yearSel = document.getElementById('year');
	const daysEl = document.getElementById('days');

	const themeBtn = document.getElementById('theme');
	const themeLabel = document.getElementById('themeLabel');
	const themeFloatingBtn = document.getElementById('themeFloating');
	const themeLabelFloating = document.getElementById('themeLabelFloating');

	const viewCalHeader = document.getElementById('viewCalHeader');
	const viewDateHeader = document.getElementById('viewDateHeader');
	const viewCalDate = document.getElementById('viewCalDate');
	const viewDateDate = document.getElementById('viewDateDate');

	const calendarView = document.getElementById('calendarView');
	const dateOnlyView = document.getElementById('dateOnlyView');
	const weekdayText = document.getElementById('weekdayText');
	const dayBadge = document.getElementById('dayBadge');
	const monthText = document.getElementById('monthText');
	const yearText = document.getElementById('yearText');

	function now() { return new Date(); }

	let state = {
		month: now().getMonth(),
		year: now().getFullYear(),
		theme: (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light',
		view: localStorage.getItem('calendar:view') || 'calendar'
	};

	// Rellenar selects
	const baseYear = now().getFullYear();
	for (let i=0;i<12;i++){ const o=document.createElement('option'); o.value=i; o.textContent=monthNames[i]; monthSel.appendChild(o); }
	for (let y = baseYear - 12; y <= baseYear + 12; y++){ const o=document.createElement('option'); o.value=y; o.textContent=y; yearSel.appendChild(o); }

	function syncThemeLabels() {
		const text = state.theme === 'dark' ? 'Dark' : 'Light';
		themeLabel.textContent = text;
		themeLabelFloating.textContent = text;
	}
	function setTheme(t) {
		root.setAttribute('data-theme', t === 'dark' ? 'dark' : 'light');
		state.theme = t; syncThemeLabels();
	}
	function toggleTheme() { setTheme(state.theme === 'light' ? 'dark' : 'light'); }

	function setView(v) {
		state.view = v === 'date' ? 'date' : 'calendar';
		localStorage.setItem('calendar:view', state.view);
		const isCalendar = state.view === 'calendar';

		// Atributo global para CSS
		root.setAttribute('data-view', state.view);

		// Mostrar/ocultar contenedores (defensa ante estilos del host)
		calendarView.style.display = isCalendar ? '' : 'none';
		dateOnlyView.style.display = isCalendar ? 'none' : 'block';

		// Sincronizar toggles
		[[viewCalHeader, isCalendar],[viewDateHeader, !isCalendar],[viewCalDate, isCalendar],[viewDateDate, !isCalendar]].forEach(([btn, on])=>{
			if (btn) btn.setAttribute('aria-pressed', on ? 'true':'false');
		});

		updateDateOnly();
	}

	// Vista "Fecha": SIEMPRE fecha actual
	function updateDateOnly() {
		const d = now();
		const jsDay = d.getDay(); // 0=Dom..6=Sáb
		const idxLunes = (jsDay + 6) % 7; // 0=Lun..6=Dom
		weekdayText.textContent = weekdayNamesUpper[idxLunes];
		dayBadge.textContent = d.getDate();
		monthText.textContent = monthNamesUpper[d.getMonth()];
		yearText.textContent = String(d.getFullYear());
	}

	function scheduleMidnightUpdate() {
		const d = now();
		const msToMidnight = new Date(d.getFullYear(), d.getMonth(), d.getDate() + 1, 0, 0, 1) - d;
		setTimeout(() => { updateDateOnly(); scheduleMidnightUpdate(); }, msToMidnight);
	}

	function render() {
		monthSel.value = state.month;
		yearSel.value = state.year;
		daysEl.innerHTML = '';

		const first = new Date(state.year, state.month, 1);
		const firstWeekday = (first.getDay() + 6) % 7; // 0 = Lunes
		const daysInMonth = new Date(state.year, state.month + 1, 0).getDate();
		const prevMonthDays = new Date(state.year, state.month, 0).getDate();

		const t = now();
		const totalCells = 42;
		for (let i = 0; i < totalCells; i++) {
			const cell = document.createElement('div'); cell.className = 'day';
			let num, out = false;
			if (i < firstWeekday) { num = prevMonthDays - firstWeekday + i + 1; out = true; }
			else if (i >= firstWeekday + daysInMonth) { num = i - (firstWeekday + daysInMonth) + 1; out = true; }
			else { num = i - firstWeekday + 1; }

			const span = document.createElement('span'); span.className = 'num'; span.textContent = num;
			if (out) cell.classList.add('out');
			const isToday = !out && num === t.getDate() && state.month === t.getMonth() && state.year === t.getFullYear();
			if (isToday) cell.classList.add('today');
			cell.appendChild(span); daysEl.appendChild(cell);
		}
	}

	// Eventos
	monthSel.addEventListener('change', () => { state.month = parseInt(monthSel.value, 10); render(); });
	yearSel.addEventListener('change', () => { state.year = parseInt(yearSel.value, 10); render(); });
	viewCalHeader.addEventListener('click', () => setView('calendar'));
	viewDateHeader.addEventListener('click', () => setView('date'));
	viewCalDate.addEventListener('click', () => setView('calendar'));
	viewDateDate.addEventListener('click', () => setView('date'));
	themeBtn.addEventListener('click', toggleTheme);
	themeFloatingBtn.addEventListener('click', toggleTheme);

	// Inicialización
	setTheme(state.theme);
	const d0 = now(); state.month = d0.getMonth(); state.year = d0.getFullYear();
	render();
	setView(state.view);   // recuerda solo la vista
	updateDateOnly();
	scheduleMidnightUpdate();
})();
</script>
</body>
</html>
